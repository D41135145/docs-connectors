= Slack Connector 1.0 Examples - Mule 4

xxx

These examples use variables for some field values. You can either:
Replace the variables with their values in the code
Provide the values for each variable in a properties file and then refer to that file from the connector configuration.
If you donâ€™t know how to use a properties file, see Configuring Property Placeholders.

== Creating a Channel

This example shows how to retrieve channel details for the user associated with the specified registered email address.

* Slack Connector +
Connects with Slack and executes a query to retrieve user details for the specified email address
* Transform message +
Outputs the results of the `Find User By Email` operation in JSON format.

The following screenshot shows app flow for this example:

image::slack-1-find-user-by-email-studio-use-case.png[Mule flow for Slack Find User By Email operation]

Creating this example involves creating a new Mule project and configuring HTTP Listener, the Slack Connector Create Channel operation, two Transform Message components and one Logger component.

=== Prerequisites

This example requires the `users:read.email` scope both on the connection configuration and on the Slack application.

== Configure HTTP Listener

Configure HTTP Listener to initiate a Mule flow when a call is made to the `/create-channel` path on localhost port 8081:

. Create a new Mule project in Studio.
. In Studio, click *HTTP* and drag the *Listener* operation to the canvas.
. On the Listener properties window, click *+* next to the *Connector configuration* field to add a global element.
. Accept the defaults.
. On the Listener properties window, set the *Path* field value to `/create-channel`.

=== Add the First Transform Message Component

This *Transform Message* component converts the channel name name to JSON format:

. In the *Mule Palette* view, select *Core* and then drag the *Transform Message* component to the right of *Listener*.
. Change the name of the *Transform Message* component to *Channel Details*.
. Click the *Transform Message* component and set the output to application/json:
<add screenshot>

=== Add the Create Channel Operation

The *Create Channel* operation connects with Slack and executes a query to retrieve the channel details for the specified email address:

. From the *Mule Palette* view, select *Slack* and then drag the *Create Channel* operation to the right of *Listener*.
. On the Search properties window, click *+* next to the *Connector configuration* field to add a global element.
. Enter the following values:
+
[%header%autowidth.spread]
|===
|Field |Value
|Consumer Key | ${consumer.key}
|Consumer Secret| ${consumer.secret}
|Authorization url | https://slack.com/oauth/authorize
|Access token url | `https://slack.com/api/oauth.access`
|Scopes | `channels, enter write groups:write im:write mpim:write users:read.email`
|Listener config |  HTTP_Listener-config
. On the Slack properties window, enter `payload` in the *Conversationcreate content* field.

=== Configure the Second Transform Message Component

This *Transform Message* component outputs the result of the *Create Channel* operation in JSON format:

. In the *Mule Palette* view, select *Core* and then drag the *Transform Message* component to the right of *Listener*.
. Change the name of the *Transform Message* component to *Payload as JSON*.
. Click the *Transform Message* component and set the output to application/json:
<add screenshot>

=== Configure the Logger Component

The *Logger* component logs the query result to the console:

. In the *Mule Palette* view, select *Core* and then select the *Logger* component.
. Configure the *Logger* component.
. Save the project.


. Test the app by sending a <REST command> request to <url>.












== Example: Find User By Email

In this example, Slack Connector Connects with Slack and executes a query to retrieve the details for a single user using the specified registered email address.

This example uses the following components:

* HTTP Listener +
Accepts data from HTTP requests
* Slack Connector +
Connects with Slack and executes a query to retrieve user details for the specified email address
* Transform message +
Outputs the results of the `Find User By Email` operation in JSON format.
* Logger +
Logs the result to the console.

This image shows the flow for finding a user and retrieving their details:

image::slack-1-find-user-by-email-studio-use-case.png[Mule flow for Slack Find User By Email operation]

=== Prerequisites

This example requires the `users:read.email` scope both on the connection configuration and on the Slack application.

== Create a Mule Project

In Studio, create a new Mule project in which to add and configure the connector:

. In Studio, select *File > New > Mule Project*.
. Enter a name for your Mule project and click *Finish*.

=== Add the Connector to Your Mule Project

Add Anypoint Connector for Slack (Slack Connector) to your Mule project to automatically populate the XML code with the connector's namespace and schema location and to add the required dependencies to the project's `pom.xml` file:

. In the *Mule Palette* view, click *(X) Search in Exchange*.
. In the *Add Dependencies to Project* window, type `slack`` in the search field.
. Click *Slack Connector* in *Available modules*.
. Click *Add*.
. Click *Finish*.

== Configure an HTTP Listener

. In the *Mule Palette* view, select *HTTP > Listener*.
. Drag *Listener* to the Studio canvas.
. On the *Listener* configuration screen, optionally change the value of the *Display Name* field.
. Specify a value for the *Path* field.
. Click the plus sign (*+*) next to the *Connector configuration* field to configure a global element that can be used by all instances of the HTTP Listener source in the app.
. On the *General* tab, specify the connection information for the connector.
. Click *Test Connection* to confirm that Mule can connect with the specified server.
. Click *OK*.

=== Configure the Find User By Email Operation

. In the *Mule Palette* view, select *Slack* and then select the *Find User by Email* operation.
. Drag the operation onto the Studio canvas and to the right of the HTTP Listener.
. Configure the operation.

=== Configure the Transform Message Component

. In the *Mule Palette* view, select *Core* and then select the *Transform Message* component.
. Configure the *Transform Message* component.

=== Configure the Logger Component

. In the *Mule Palette* view, select *Core* and then select the *Logger* component.
. Configure the *Logger* component.
. Save the project.
. Test the app by sending a <REST command> request to <url>.

== Example: Send Message To Channel

This example posts a message to a public channel, private channel, or direct message channel.

This example uses the following components:

* Listener (HTTP) +
Accepts data from HTTP requests
* Transform message +
Provides content (message details) for the *Send Message* operation
* Slack Connector +
Connects with Slack and posts a message to an existing channel
* Transform message +
Outputs the results of the `Send Message` operation in JSON format
* Logger +
Logs the result to the console

The following image shows the flow for sending a message to a channel:

image::slack-1-send-message-studio-use-case.png[Mule flow for Slack operation Send Message to a channel]

=== Prerequisites

This example requires the following scopes in both the connection configuration and on the Slack app:

* `chat:write`
* `chat:write:user`
* `chat:write:bot`

== XML Flows

Paste this XML code into Anypoint Studio to experiment with the flows described in the previous sections:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:slack="http://www.mulesoft.org/schema/mule/slack"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/slack http://www.mulesoft.org/schema/mule/slack/current/mule-slack.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<slack:config name="Slack_Connector_Config" doc:name="Slack Connector Config" doc:id="bf65753c-6e76-4ddc-888e-a2032e64613b" >
		<slack:slack-auth-connection >
			<slack:oauth-authorization-code consumerKey="${consumer.key}" consumerSecret="${consumer.secret}" scopes="channels:write groups:write im:write mpim:write users:read.email "/>
			<slack:oauth-callback-config listenerConfig="HTTP_Listener_config" callbackPath="/callback" authorizePath="/authorize" externalCallbackUrl="http://localhost:8081/callback"/>
		</slack:slack-auth-connection>
	</slack:config>
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="739b6c08-0e6b-416a-9888-7a8ad4918d2e" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<configuration-properties doc:name="Configuration properties" doc:id="0252219a-f797-482f-8c04-440115b82bc4" file="application.properties" />
	<flow name="find-user-by-email-flow" doc:id="6f85a088-7469-4b0c-9453-307238ab1eea" >
		<http:listener doc:name="Listener" doc:id="f88ae414-05a0-47c4-8a9a-a63918eb4be9" config-ref="HTTP_Listener_config" path="find-by-email"/>
		<slack:get-userslookup-by-email doc:name="Find User by Email" doc:id="4b7dc5a2-316d-49ba-9bb9-c746182faf0d" config-ref="Slack_Connector_Config" email="example@emailaddress.com"/>
		<ee:transform doc:name="Payload as Json" doc:id="925f7a13-520e-4043-bf97-b825c9f87e6d" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Lookup Result" doc:id="c532fa79-ef7e-4ae3-88cc-d0d769e478ff" message="#[payload]"/>
	</flow>
  <flow name="send-message-to-channel-flow" doc:id="5c2354c1-16df-4b56-9248-d43e541217d2" >
		<http:listener doc:name="Listener" doc:id="c5ae59fd-0c68-4ac7-9a32-2d590955038e" config-ref="HTTP_Listener_config" path="/send-message"/>
		<ee:transform doc:name="Message Details" doc:id="2ca18e59-5484-4997-bbe7-62f1f6c2d640" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	channel: "your-existing-channel",
	text: "Your text goes here"
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<slack:create-chatpost-message doc:name="Send Message" doc:id="e09a0f1e-3082-4263-be94-3d01d6460043" config-ref="Slack_Connector_Config"/>
		<ee:transform doc:name="Payload as Json" doc:id="7c490195-89b3-4da8-a7ea-672f54563c6f">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Result" doc:id="7236a860-530e-48da-9c15-e8d112e19399" message="#[payload]"/>
	</flow>
</mule>

----

== See Also

* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
